glimpse(data)
class(data)
filtered_data <- data %>%
filter(Date_collected!="n.d.") %>%
separate(Date_collected,c("day","month","year")) %>%
mutate(day=as.integer(day),month=as.integer(month),year=as.integer(year)) %>%
arrange(year,month,day)
all_pollinators <- distinct(filtered_data,Pollinator)
##what about ?
all_plants <- distinct(filtered_data,Plant)
#exploratory analysis
#totla n:
n_pollinator <- filtered_data %>% summarise(Pollinator=length(unique(Pollinator)))
n_pollinator
n_plant <- filtered_data %>% summarise(Plant=length(unique(Plant)))
n_plant
#per year:
filtered_data %>% group_by(year) %>% summarise(P=length(unique(Pollinator)))
filtered_data %>% group_by(year) %>% summarise(P=length(unique(Plant)))
#per layer
filtered_data %>% group_by(year,month,day) %>%
summarise(Pollinator=length(unique(Pollinator)))
#per year:
filtered_data %>% group_by(year) %>% summarise(P=length((Pollinator)))
#per layer
filtered_data %>% group_by(year,month,day) %>%
summarise(Pollinator=length(unique(Pollinator)))
ZAC_CR <- read_csv('/Users/Shai/Dropbox (BGU)/Grants/ISF 2019/data/Rasmussen2013/ZAC CR.csv')
head(ZAC_CR)
sapply(ZAC_CR, class)
class(ZAC_CR)
ZAC_CR <- read_csv("C:/Users/shiri/shir/R programming/ZAC_CR.csv")
head(ZAC_CR)
sapply(ZAC_CR, class)
class(ZAC_CR)
ZAC_CR %>%
filter(!is.na(ZAC_CR)) %>%
ZAC_CR %>%
separate(Date_collected, sep="-", into = c("year", "month", "day"))
dat
list_to_matrix <- function(l, directed=F, bipartite=T){
# Only deal with first 3 columns.
g <- graph.data.frame(l,directed = directed)
if(bipartite){
V(g)$type <- V(g)$name %in% as.data.frame(l)[,1] # As.data.frame is necessary because if l is a tibble then l[,1] does not work
output_mat <- as_incidence_matrix(g, names = T, attr = 'w', sparse = F)
} else {
output_mat <- as_adjacency_matrix(g, names = T, sparse = F, attr = 'w')
}
# print(dim(output_mat))
# if(any(rowSums(output_mat)==0)){stop('One or more rows sum to 0')}
# if(any(colSums(output_mat)==0)){stop('One or more columns sum to 0')}
return(output_mat)
}
matrix_to_list <- function(x, group_names=c('set_cols','set_rows')){
g <- graph.incidence(t(x), directed = F, weighted = T) # transposing ensures that from is at the columns and to is the rows
l_bip <- igraph::as_data_frame(g, 'edges')
names(l_bip) <- c('set_cols','set_rows','weight')
nodes <- c(sort(unique(l_bip$set_cols)),sort(unique(l_bip$set_rows)))
node_list <- tibble(node_id=1:length(nodes),
node_type=c(rep('c',length(unique(l_bip$set_cols))),rep('r',length(unique(l_bip$set_rows)))),
node_group=c(rep(group_names[1],length(unique(l_bip$set_cols))),rep(group_names[2],length(unique(l_bip$set_rows)))),
node_name=nodes)
return(list(edge_list=l_bip, node_list=node_list))
}
raw_data <- read_csv('/Users/Shai/Dropbox (BGU)/Grants/ISF 2019/data/Rasmussen2013/ZAC CR.csv')
raw_data
# Clean and organize the data
dat <- raw_data %>% filter(Date_collected!="n.d.") %>%
#Clean and organize
separate(Date_collected,c("month","day","year"), sep = '/') %>%
mutate(Pollinator=str_replace(Pollinator,'\"','')) %>%
mutate(Pollinator=str_replace(Pollinator,'\"_','_')) %>%
mutate(day=as.integer(day),
month=as.integer(month),
year = case_when(year==96~1996,
year==97~1997,
year==10~2010,
year==11~2011)) %>%
# Add a date
mutate(Date=as_date(paste(year,month,day,sep='-'))) %>%
arrange(Date) %>%
# Add layer number
group_by(year) %>%
do(mutate(.,layer=group_indices(.,month,day))) %>%
select(Date,year,month,day,layer,Pollinator,Plant)
# N
dat
paste('Hello','Carmel','Shir')
paste('Hello','Carmel','Shir',sep='-')
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date))
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date))
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date)) %>%
ggplot(aes(x=Date, y=Pollinators))+geom_line()
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date)) %>%
ggplot(aes(x=Date, y=Pollinators))+
facet_wrap(~year)+
geom_line()
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date)) %>%
ggplot(aes(x=Date, y=Pollinators))+
facet_wrap(~year, scale=scales = 'free_x')+
geom_line()
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date)) %>%
ggplot(aes(x=Date, y=Pollinators))+
facet_wrap(~year, scale = 'free_x')+
geom_line()
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date)) %>%
ggplot(aes(x=Date, y=Pollinators))+
facet_wrap(~year, scale = 'free_x')+
geom_line()+geom_point()
geom_line(aes(x=Date, y=Plant))+geom_point(aes(x=Date, y=Plant))
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date)) %>%
ggplot()+
facet_wrap(~year, scale = 'free_x')+
geom_line(aes(x=Date, y=Pollinators))+geom_point(aes(x=Date, y=Pollinators))+
geom_line(aes(x=Date, y=Plant))+geom_point(aes(x=Date, y=Plant))
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date)) %>%
ggplot()+
facet_wrap(~year, scale = 'free_x')+
geom_line(aes(x=Date, y=Pollinators))+geom_point(aes(x=Date, y=Pollinators))+
geom_line(aes(x=Date, y=Plants))+geom_point(aes(x=Date, y=Plants))
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date)) %>%
ggplot()+
facet_wrap(~year, scale = 'free_x')+
geom_line(aes(x=Date, y=Pollinators), color='blue')+geom_point(aes(x=Date, y=Pollinators), color='blue')+ # Pollinators
geom_line(aes(x=Date, y=Plants))+geom_point(aes(x=Date, y=Plants)) # Plants
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date)) %>%
gather(key, value)
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date)) %>%
gather(key = 'my_key', value)
dat
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date)) %>%
gather(key = 'my_key', value, -Date)
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date))
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date)) %>%
select(Date, Pollinators, Plants)
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date)) %>%
ungroup() %>%
select(Date, Pollinators, Plants)
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date)) %>%
ungroup() %>%
select(Date, Pollinators, Plants) %>%
gather(key = 'my_key', value)
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date)) %>%
ungroup() %>%
select(Date, Pollinators, Plants) %>%
gather(key = 'my_key', value, -Date)
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date)) %>%
ungroup() %>%
select(Date, Pollinators, Plants) %>%
gather(key = 'my_key', value, -Date) %>%
ggplot(aes(x=Date, y=value, color=my_key))+geom_line()
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date)) %>%
ungroup() %>%
select(Date, Pollinators, Plants) %>%
gather(key = 'my_key', value, -Date) %>%
ggplot(aes(x=Date, y=value, color=my_key))+
facet_wrap(~year, scale = 'free_x')+
geom_line()
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date)) %>%
select(Date, Pollinators, Plants) %>%
gather(key = 'my_key', value, -Date, -year) %>%
ggplot(aes(x=Date, y=value, color=my_key))+
facet_wrap(~year, scale = 'free_x')+
geom_line()
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date))
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date)) %>%
select(Date, Pollinators, Plants) %>%
gather(key = 'my_key', value, -Date, -year)
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date))
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date)) %>%
select(Date, Pollinators, Plants) %>%
gather(key = 'my_key', value, -Date, -year) %>% print(n=Inf)
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date))
dat %>%
# filter(year==1996) %>%
group_by(year, Date, layer) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date)) %>%
gather(key = 'my_key', value, -Date, -year) %>%
ggplot(aes(x=Date, y=value, color=my_key))+
facet_wrap(~year, scale = 'free_x')+
geom_line()
dat %>%
# filter(year==1996) %>%
group_by(year, Date) %>%
summarise(Pollinators=length(unique(Pollinator)),
Plants=length(unique(Plant)),
interactions=length(Date)) %>%
gather(key = 'my_key', value, -Date, -year) %>%
ggplot(aes(x=Date, y=value, color=my_key))+
facet_wrap(~year, scale = 'free_x')+
geom_line()
library(entropy)
entropy(c(1/20,1/20,1/20,1/20), unit = 'log2')
entropy(c(1/5,1/5,1/5,1/5), unit = 'log2')
entropy(c(1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20), unit = 'log2')
20/20*entropy(c(1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20), unit = 'log2')
H <- function(){entropy(x, unit = 'log2')}
H <- function(x){entropy(x, unit = 'log2')}
20/20*H(c(1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20))
4/20*H(c(1/20,1/20,1/20,1/20))+4*6/20*H(c(1/6,1/6,1/6,2/6,1/6))
4/20*H(c(1/20,1/20,1/20,1/20))+4*6/20*H(c(1/20,1/20,1/20,2/20,1/20))
1/20,1/20,1/20,1/20,
H(c(1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20))
H(c(1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20))
H(c(1/20,1/20,1/20,1/20,1/20,1/20,1/20,1/20))
H(c(1/4,1/4,1/4,1/4,1/4,1/4,1/4,1/4))
x=c(1/4,1/4,1/4,1/4,1/4,1/4,1/4,1/4)
freqs <- table(buys)/length(buys)
freqs <- table(x)/length(x)
-sum(freqs * log2(freqs))
x
table(x)
length(x)
freqs
x/sum(x)
H <- function(x){entropy(x, method = 'ML', unit = 'log2')}
20/20*H(c(1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20))
4/20*H(c(1/20,1/20,1/20,1/20))+4*6/20*H(c(1/20,1/20,1/20,2/20,1/20))
H(c(1/20,1/20,1/20,1/20,1/20,1/20,1/20,1/20))
H(c(1/4,1/4,1/4,1/4,1/4,1/4,1/4,1/4))
x=c(1/4,1/4,1/4,1/4,1/4,1/4,1/4,1/4)
freqs * log2(freqs)
freqs <- table(x)/length(x)
x/sum(x)
H <- function(x){entropy(x, method = 'ML', unit = 'log2')}
20/20*H(c(1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20))
4/20*H(c(1/20,1/20,1/20,1/20))+4*6/20*H(c(1/20,1/20,1/20,2/20,1/20))
c(1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20)
H(c(1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20)
20/20*H(c(1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20,
1/20,1/20,1/20,1/20))
20/20*H(c(1/20,1/20,1/20,2/20,
1/20,1/20,1/20,2/20,
1/20,1/20,1/20,2/20,
1/20,1/20,1/20,2/20))
4/20*H(c(1/20,1/20,1/20,1/20))+4*6/20*H(c(1/20,1/20,1/20,2/20,1/20))
library(infomapecology)
?create_infomap_linklist
#https://figshare.com/articles/Data_package_from_Evaluating_the_effects_of_pollinator_mediated_interactions_using_pollen_transfer_networks_evidence_of_widespread_facilitation_in_south_Andean_plant_communities_Tur_et_al_2016_/2242447
tur2016 <- read_csv('Tur2016.csv')
library(tidyverse)
#https://figshare.com/articles/Data_package_from_Evaluating_the_effects_of_pollinator_mediated_interactions_using_pollen_transfer_networks_evidence_of_widespread_facilitation_in_south_Andean_plant_communities_Tur_et_al_2016_/2242447
tur2016 <- read_csv('Tur2016.csv')
setwd('~/GitHub/infomap_ecology')
#https://figshare.com/articles/Data_package_from_Evaluating_the_effects_of_pollinator_mediated_interactions_using_pollen_transfer_networks_evidence_of_widespread_facilitation_in_south_Andean_plant_communities_Tur_et_al_2016_/2242447
tur2016 <- read_csv('Tur2016.csv')
save(tur2016, file="../infomap_ecology_package/data/mydata.RData")
save(tur2016, file="../infomap_ecology_package/data/tur2016.RData")
setwd("~/GitHub/infomap_ecology_package")
devtools::document()
library(infomapecology)
devtools::document()
library(infomapecology)
library(infomapecology)
data("tur2016")
tur2016
x=tur2016
x
devtools::document()
devtools::document()
Sys.getenv()
devtools::session_info()
devtools::document()
library(infomapecology)
devtools::use_rcpp()
devtools::load_all()
devtools::document()
devtools::document()
library(infomapecology)
devtools::document()
library(infomapecology)
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
library(infomapecology)
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
library(infomapecology)
devtools::document()
library(infomapecology)
devtools::document()
devtools::document()
library(infomapecology)
infomapR('ninetriangles.net')
devtools::document()
library(infomapecology)
devtools::document()
library(infomapecology)
devtools::document()
library(infomapecology)
infomapecology::timesTwo(5)
devtools::document()
devtools::document()
devtools::document()
library(infomapecology)
infomapecology::timesTwo(4)
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
library(infomapecology)
library(infomapecology)
devtools::document()
library(infomapecology)
timesTwo(5)
devtools::document()
compileAttributes()
devtools::document()
devtools::document()
devtools::check()
devtools::check()
devtools::check()
devtools::check()
devtools::check()
devtools::document()
compileAttributes()
devtools::document()
devtools::document()
devtools::document()
